# MongoDB

MongoDB is a NoSQL, document-oriented database that stores data in flexible, JSON-like documents..

In MongoDB, **collections** and **documents** are fundamental concepts used to store and manage data.

1. **Collection**
   A collection in MongoDB is a grouping of MongoDB documents. It's similar to a table in a relational database.

- **Schema-less:** Collections do not enforce a schema, meaning that documents within the same collection can have different fields or data types.

- **Implicit Creation:** Collections are created implicitly when you insert a document into them. You don't need to explicitly create a collection before using it.

- **Organization:** Collections are stored within a database, and a single database can have multiple collections.

**Example:** In a bookstore database, you might have collections such as books, authors, and genres.

2. **Document**
   A document in MongoDB is a record in a collection. Documents are stored in a format called BSON (Binary JSON) but are typically represented as JSON-like structures.

- **Flexibility:** Documents can have nested fields, arrays, and even other documents as values.

- **Unique Identifier:** Each document has a unique identifier called \_id, which is automatically generated by MongoDB if not provided.

- **Schema-less:** Documents are flexible and schema-less, allowing you to store different types of data in the same collection.

**Example:** A document in the books collection might look like this:

```js
{
  "_id": { "$oid": "66c4476627f54d54af6b1c24" },
  "title": "Book1",
  "author": "Author 1",
  "genre": ["genre1", "genre2", "genre3"],
  "rating": 9,
  "reviews": [
    { "user": "User1", "comment": "Great book!", "rating": 5 },
    { "user": "User2", "comment": "Enjoyed reading", "rating": 4 }
  ]
}

```

## BSON

BSON is a binary encoding of JSON-like documents. Unlike JSON, which is text-based, BSON is designed to be efficient in both storage and retrieval, making it more suitable for high-performance applications.

BSON supports additional data types that are not available in JSON. Some of these include:

- **ObjectId:** A 12-byte unique identifier used as a primary key in MongoDB documents.
- **Date:** Represents date and time, which is stored as a 64-bit integer.
- **Binary Data:** Allows storage of raw binary data.
- **Int32 and Int64:** Distinguishes between 32-bit and 64-bit integers.
- **Decimal128:** High-precision decimal floating-point format for storing financial data.

### Why BSON is Used in MongoDB:

- **Performance:** BSON's binary format allows MongoDB to efficiently encode and decode documents, making operations faster than they would be with plain text JSON.
  **Rich Data Types:** BSON supports a wider range of data types than JSON, allowing MongoDB to store more complex data structures.
  **Storage Optimization:** BSON is more compact than JSON, which helps in reducing storage space, especially for large-scale databases.

## ObjectId

Each document has a unique identifier (\_id), which is automatically generated as a 12-byte ObjectId.

_For this documentation, weâ€™ll use a bookstore database as our example. Each book is represented as a document containing information like title, author, genre, rating, and user reviews._

## MongoDB Shell Commands

### Database Management

- **`show dbs`** - Lists all databases.
- **`use <database_name>`** - Creates a new database or switches to an existing one.
- **`db`** - Prints the name of the current database.
- **`show collections`** - Lists all collections in the current database.
- **`db.dropDatabase()`** - Delete the Data Base (After switching to that DB)
- **`db.collection_name.drop()`** Delete a Collection from a DB
- **`cls`** - Clears the screen.
- **`help`** - Lists all available commands.
- **`exit`** - Exits the MongoDB shell.

### Creating Collections

- **Implicit Creation:** Collections are created automatically when a document is inserted into a non-existent collection.

```js
db.books.insertOne({
  title: "Book1",
  auther: "auther 1",
  genre: ["genre1", "genre2", "genre3"],
  rating: 9,
  reviews: [
    { user: "User1", comment: "Great book!", rating: 5 },
    { user: "User2", comment: "Enjoyed reading", rating: 4 },
  ],
});
```

- **Explicit Creation\***

```js
db.createCollection("books");
```

### Document Insertion

- **Single Document:**

```js
db.books.insertOne({
  title: "Book1",
  auther: "auther 1",
  genre: ["genre1", "genre2", "genre3"],
  rating: 9,
  reviews: [
    { user: "User1", comment: "Great book!", rating: 5 },
    { user: "User2", comment: "Enjoyed reading", rating: 4 },
  ],
});
```

- **Multiple Documents:**+

```js
db.books.insertMany([
  {
    title: "Book2",
    auther: "auther 2",
    genre: ["genre1", "genre4"],
    rating: 8,
    reviews: [{ user: "User3", comment: "Good read", rating: 4 }],
  },
  {
    title: "Book3",
    auther: "auther 3",
    genre: ["genre2", "genre5"],
    rating: 7,
    reviews: [],
  },
]);
```

### Querying Data

1. **Find All Documents:**

```js
db.books.find();

// return the complete book collection
```

2. **Find with Filter:**

```js
db.books.find({ author: "Author 1" });

// return all documents with author === Author 1
```

3. **Select Specific Fields**

```js
db.books.find({ author: "Author 1" }, { title: 1, author: 1 });

// return Author 1 but only get data of title,author,id

/*
[
  {
    "_id": { "$oid": "66c4476627f54d54af6b1c24" },
    "title": "Book1",
    "author": "Author 1"
  }
]
*/
```

4. **Find One Document:**

```js
db.books.findOne({ auther: "auther 1" });

// return only one document
```

5. **Find Only one Field from Document**

```js
db.books.find({}, { _id: 0, author: 1 });

// return all authors
```

### Using the distinct Method:

The distinct method in MongoDB is used to find unique values for a specified field in a collection

Syntax:

```js
db.collection.distinct(field, query);
```

- field: The name of the field for which you want to find distinct values.
- query: An optional filter to limit the documents considered.

example :

1.

```js
db.books.distinct("genre");

// returns all values included in genre key
```

2.

```js
db.books.distinct("genre", { rating: 9 });

// return all genere that has comes under rating 9
```

### Sorting and Limiting and Skipping

1. **Count Documents:**

```js
db.books.find().count();

// return a number which the count of total documents
```

2. **Limit the Number of Results:**

```js
db.books.find().limit(2);

// only returns 2 documents because the limit == 2
```

3. **Skip Documents**

```js
db.books.find().skip(4);

// Skip first 4 documents and return from 5 th document
```

4. **Sort Results:**

```js
db.books.find().sort({ rating: -1 });

// Sort by rating in descending order
```

```js
db.books.find().sort({ title: 1 });

// Sort by title in ascending order
```

### Complex Queries and Operators

**Comparison Operators:**

1. `$gt` - Greater than

```js
db.books.find({ rating: { $gt: 8 } });

// return documents with rating is greater than 8
```

2. `$lt` - Less than

```js
db.books.find({ rating: { $lt: 8 } });

// Returns documents where the rating is less than 8
```

3. `$gte`- Greater than or equal to

```js
db.books.find({ rating: { $gte: 8 } });

// Returns documents where the rating is greater than or equal to 8
```

4. `$lte` - Less than or equal to

```js
db.books.find({ rating: { $lte: 8 } });

// Returns documents where the rating is less than or equal to 8
```

**Logical Operators:**

1. **`$or`**
   Matches documents that satisfy at least one of the conditions.

```js
db.books.find({
  $or: [{ rating: 9 }, { author: "Author 2" }],
});

// Returns documents where either the rating is 9 or the author is "Author 2"
```

2. **`$and`**  
   Matches documents that satisfy all the given conditions

```js
db.books.find({
  $and: [{ rating: { $gte: 8 } }, { genre: "genre1" }],
});

// Returns documents where the rating is greater than or equal to 8 and the genre includes "genre1"
```

### Querying Nested Documents

You can query nested documents by specifying the path to the field within the nested structure.

```js
db.books.find({ "reviews.user": "User1" });

// Returns documents where there is a review with the user "User1"
```

## Updating Documents

1. **Update a Single Document:**
   This operation updates the first document that matches the filter criteria.

```js
db.books.updateOne({ title: "Book1" }, { $set: { rating: 10 } });

// Updates the rating of the book titled "Book1" to 10
```

2. **Update Multiple Documents:**
   This operation updates all documents that match the filter criteria.

```js
db.books.updateMany({ author: "Author 1" }, { $set: { rating: 8 } });

// Updates the rating of all books authored by "Author 1" to 8
```

3. **Replace a Document:**
   This operation replaces an entire document with a new one.

```js
db.books.replaceOne(
  { title: "Book1" },
  { title: "New Title", author: "New Author", rating: 7 }
);

// Replaces the entire document with a new one having the specified title, author, and rating
```

### Querying by Array Values

You can query documents where an array field contains a specific value.

```js
db.books.find({ genre: "genre1" });

// Returns documents where the genre array includes "genre1"
```

1. **$in**
   Matches documents where the value of a field equals any value in the specified array

```js
db.books.find({
  genre: { $in: ["genre1", "genre2"] },
});

// Returns documents where the genre field includes either "genre1" or "genre2"
```

2. **$nin**

   The $nin operator matches documents where the value of a field does not equal any value in the specified array.

```js
db.books.find({
  genre: { $nin: ["genre1", "genre2"] },
});

// Returns documents where the genre field does not include "genre1" or "genre2"
```

3. **$all**

The `$all` operator matches arrays that contain all the specified elements. Unlike `$in`, which matches any of the specified elements, `$all` requires all specified elements to be present in the array.

```js
db.books.find({ genre: { $all: ["genre1", "genre2"] } });

// Returns documents where the genre array includes both "genre1" and "genre2"
```

4. **$push - Add an Element to an Array:**

   This operation adds a new element to an array within a document.

```js
db.books.updateOne(
  { title: "Book1" },
  {
    $push: { reviews: { user: "User3", comment: "Another review", rating: 4 } },
  }
);

// Adds a new review to the reviews array for the book titled "Book1"
```

5. **$pull - Remove an Element from an Array:**

   This operation removes an element from an array within a document.

```js
db.books.updateOne(
  { title: "Book1" },
  { $pull: { reviews: { user: "User1" } } }
);

// Removes the review by "User1" from the reviews array for the book titled "Book1"
```

6. **$addToSet - Add an Element to an Array if it Doesn't Exist**

The `$addToSet` operator adds a value to an array only if it does not already exist

```js
db.books.updateOne({ title: "Book1" }, { $addToSet: { genre: "genre4" } });
// Adds "genre4" to the genre array of "Book1" if it's not already present
```

7. **$pop - Remove the First or Last Element from an Array**

The `$pop` operator removes either the first or last element from an array, depending on the value passed (1 for the last element, -1 for the first).

```js
db.books.updateOne({ title: "Book1" }, { $pop: { reviews: 1 } });
// Removes the last review from the reviews array of "Book1"
```

8. **$pullAll - Remove Multiple Elements from an Array**

The $pullAll operator removes all instances of the specified values from an array.

```js
db.books.updateOne(
  { title: "Book1" },
  { $pullAll: { genre: ["genre1", "genre3"] } }
);
// Removes "genre1" and "genre3" from the genre array of "Book1"
```

9. **$elemMatch**

The `$elemMatch` operator matches documents where at least one element in the array matches all the specified criteria. This is particularly useful for arrays of sub documents.

```js
db.books.find({
  reviews: { $elemMatch: { rating: { $gte: 8 }, reviewText: /excellent/i } },
});

// Returns documents where at least one review in the reviews array has a rating of 8 or higher and contains the word "excellent"
```

10. **$slice**

The `$slice` operator is used in projections to return a subset of the array

```js
db.books.find({}, { reviews: { $slice: 3 } });

// Returns only the first 3 reviews from the reviews array in each document
```

11. **$each**

The `$each` modifier is used in conjunction with $push or `$addToSet` to add multiple elements to an array in a single operation.

```js
db.books.updateOne(
  { title: "Book1" },
  { $push: { genre: { $each: ["genre4", "genre5"] } } }
);

// Adds "genre4" and "genre5" to the genre array in the document with title "Book1"
```

12. **$position**

The `$position` modifier is used with $push to insert elements at a specified position within an array.

```js
db.books.updateOne(
  { title: "Book1" },
  { $push: { genre: { $each: ["genre0"], $position: 0 } } }
);

// Inserts "genre0" at the beginning of the genre array in the document with title "Book1"
```

13. **$sort**

The $sort modifier is used with $push to sort the array after modifying it.

```js
db.books.updateOne(
  { title: "Book1" },
  { $push: { genre: { $each: ["genre4"], $sort: 1 } } }
);

// Adds "genre4" to the genre array and sorts the array in ascending order
```

**Field Update Operators:**
Field update operators allow you to modify specific fields in documents. These operators are often used with update methods like `updateOne()` and `updateMany()`.

1. **`$inc` - Increment the Value of a Field**

The `$inc` operator increases the value of a field by a specified amount. If the field does not exist, it will be created.

```js
db.books.updateOne({ title: "Book1" }, { $inc: { rating: 1 } });
// Increases the rating of "Book1" by 1
```

2. **`$mul` - Multiply the Value of a Field**

The $mul operator multiplies the value of a field by a specified amount.

```js
db.books.updateOne({ title: "Book1" }, { $mul: { rating: 2 } });
// Doubles the rating of "Book1"
```

3. **`$rename` - Rename a Field**

The $rename operator changes the name of a field in a document.

```js
db.books.updateOne({ title: "Book1" }, { $rename: { author: "writer" } });
// Renames the "author" field to "writer" in the "Book1" document
```

4. **`$unset` - Remove a Field**

The $unset operator deletes a specified field from a document.

```js
db.books.updateOne({ title: "Book1" }, { $unset: { rating: "" } });
// Removes the "rating" field from the "Book1" document
```

### Geospatial Queries

MongoDB supports geospatial queries, allowing you to perform location-based queries on geospatial data.

1. **`$geoWithin` - Find Documents within a Geographic Area**

The $geoWithin operator finds documents located within a specified geographic area.

```js
db.places.find({
  location: {
    $geoWithin: {
      $geometry: {
        type: "Polygon",
        coordinates: [
          [
            [longitude1, latitude1],
            [longitude2, latitude2],
            [longitude3, latitude3],
            [longitude1, latitude1],
          ],
        ],
      },
    },
  },
});
// Returns all places within the defined polygon area
```

2. **`$near` - Find Documents near a Specific Location**

The $near operator finds documents that are close to a specified point. It can be used with both 2D and 2DSphere indexes.

```js
db.places.find({
  location: {
    $near: {
      $geometry: {
        type: "Point",
        coordinates: [longitude, latitude],
      },
      $maxDistance: 1000,
    },
  },
});
// Returns all places within 1000 meters of the specified location
```

### Deleting Documents

1. **Delete a Single Document:**
   This operation deletes the first document that matches the filter criteria.

```js
db.books.deleteOne({ title: "Book1" });

// Deletes the document where the title is "Book1"
```

2. **Delete Multiple Documents:**
   This operation deletes all documents that match the filter criteria.

```js
db.books.deleteMany({ author: "Author 1" });

// Deletes all documents where the author is "Author 1"
```

### Indexing

Indexes improve the performance of read operations by allowing the database to quickly locate data.

1. **Create an Index:**
   This command creates an index on the specified field.

```js
db.books.createIndex({ title: 1 });

// Creates an index on the title field in ascending order
```

Output:

```json
"Index creation successful: title_1"
```

2. **View Indexes:**
   This command lists all the indexes on the collection.

```js
db.books.getIndexes();

// Displays all the indexes created on the books collection
```

3. **Drop an Index:**
   This command removes the specified index from the collection.

```js
db.books.dropIndex({ title: 1 });

// Drops the index on the title field
```

Output :

```json
"Index drop successful: title_1"
```
