# MongoDB

MongoDB is a NoSQL, document-oriented database that stores data in flexible, JSON-like documents..

In MongoDB, **collections** and **documents** are fundamental concepts used to store and manage data.

1. **Collection**
   A collection in MongoDB is a grouping of MongoDB documents. It's similar to a table in a relational database.

- **Schema-less:** Collections do not enforce a schema, meaning that documents within the same collection can have different fields or data types.

- **Implicit Creation:** Collections are created implicitly when you insert a document into them. You don't need to explicitly create a collection before using it.

- **Organization:** Collections are stored within a database, and a single database can have multiple collections.

**Example:** In a bookstore database, you might have collections such as books, authors, and genres.

2. **Document**
   A document in MongoDB is a record in a collection. Documents are stored in a format called BSON (Binary JSON) but are typically represented as JSON-like structures.

- **Flexibility:** Documents can have nested fields, arrays, and even other documents as values.

- **Unique Identifier:** Each document has a unique identifier called \_id, which is automatically generated by MongoDB if not provided.

- **Schema-less:** Documents are flexible and schema-less, allowing you to store different types of data in the same collection.

**Example:** A document in the books collection might look like this:

```js
{
  "_id": { "$oid": "66c4476627f54d54af6b1c24" },
  "title": "Book1",
  "author": "Author 1",
  "genre": ["genre1", "genre2", "genre3"],
  "rating": 9,
  "reviews": [
    { "user": "User1", "comment": "Great book!", "rating": 5 },
    { "user": "User2", "comment": "Enjoyed reading", "rating": 4 }
  ]
}

```

## BSON

BSON is a binary encoding of JSON-like documents. Unlike JSON, which is text-based, BSON is designed to be efficient in both storage and retrieval, making it more suitable for high-performance applications.

BSON supports additional data types that are not available in JSON. Some of these include:

- **ObjectId:** A 12-byte unique identifier used as a primary key in MongoDB documents.
- **Date:** Represents date and time, which is stored as a 64-bit integer.
- **Binary Data:** Allows storage of raw binary data.
- **Int32 and Int64:** Distinguishes between 32-bit and 64-bit integers.
- **Decimal128:** High-precision decimal floating-point format for storing financial data.

### Why BSON is Used in MongoDB:

- **Performance:** BSON's binary format allows MongoDB to efficiently encode and decode documents, making operations faster than they would be with plain text JSON.
  **Rich Data Types:** BSON supports a wider range of data types than JSON, allowing MongoDB to store more complex data structures.
  **Storage Optimization:** BSON is more compact than JSON, which helps in reducing storage space, especially for large-scale databases.

## ObjectId

Each document has a unique identifier (\_id), which is automatically generated as a 12-byte ObjectId.

_For this documentation, weâ€™ll use a bookstore database as our example. Each book is represented as a document containing information like title, author, genre, rating, and user reviews._

## MongoDB Shell Commands

### Database Management

- **`show dbs`** - Lists all databases.
- **`use <database_name>`** - Creates a new database or switches to an existing one.
- **`db`** - Prints the name of the current database.
- **`show collections`** - Lists all collections in the current database.
- **`db.dropDatabase()`** - Delete the Data Base (After switching to that DB)
- **`db.collection_name.drop()`** Delete a Collection from a DB
- **`cls`** - Clears the screen.
- **`help`** - Lists all available commands.
- **`exit`** - Exits the MongoDB shell.

### Creating Collections

- **Implicit Creation:** Collections are created automatically when a document is inserted into a non-existent collection.

```js
db.books.insertOne({
  title: "Book1",
  auther: "auther 1",
  genre: ["genre1", "genre2", "genre3"],
  rating: 9,
  reviews: [
    { user: "User1", comment: "Great book!", rating: 5 },
    { user: "User2", comment: "Enjoyed reading", rating: 4 },
  ],
});
```

- **Explicit Creation\***

```js
db.createCollection("books");
```

### Document Insertion

- **Single Document:**

```js
db.books.insertOne({
  title: "Book1",
  auther: "auther 1",
  genre: ["genre1", "genre2", "genre3"],
  rating: 9,
  reviews: [
    { user: "User1", comment: "Great book!", rating: 5 },
    { user: "User2", comment: "Enjoyed reading", rating: 4 },
  ],
});
```

- **Multiple Documents:**+

```js
db.books.insertMany([
  {
    title: "Book2",
    auther: "auther 2",
    genre: ["genre1", "genre4"],
    rating: 8,
    reviews: [{ user: "User3", comment: "Good read", rating: 4 }],
  },
  {
    title: "Book3",
    auther: "auther 3",
    genre: ["genre2", "genre5"],
    rating: 7,
    reviews: [],
  },
]);
```

### Querying Data

1. **Find All Documents:**

```js
db.books.find();

// return the complete book collection
```

2. **Find with Filter:**

```js
db.books.find({ author: "Author 1" });

// return all documents with author === Author 1
```

3. **Select Specific Fields**

```js
db.books.find({ author: "Author 1" }, { title: 1, author: 1 });

// return Author 1 but only get data of title,author,id

/*
[
  {
    "_id": { "$oid": "66c4476627f54d54af6b1c24" },
    "title": "Book1",
    "author": "Author 1"
  }
]
*/
```

4. **Find One Document:**

```js
db.books.findOne({ auther: "auther 1" });

// return only one document
```
5. **Find Only one Field from Document**

```js
db.books.find({}, { _id: 0, author: 1 });

// return all authors

```

### Using the distinct Method:
The distinct method in MongoDB is used to find unique values for a specified field in a collection

Syntax:
```js

db.collection.distinct(field, query)

```

* field: The name of the field for which you want to find distinct values.
* query: An optional filter to limit the documents considered.

example :
1. 
```js

db.books.distinct("genre")

// returns all values included in genre key 

```
2. 
```js 

db.books.distinct("genre", { rating: 9 })

// return all genere that has comes under rating 9 

```



### Sorting and Limiting and Skipping

1. **Count Documents:**

```js
db.books.find().count();

// return a number which the count of total documents
```

2. **Limit the Number of Results:**

```js
db.books.find().limit(2);

// only returns 2 documents because the limit == 2
```
3. **Skip Documents**

```js
db.books.find().skip(4);

// Skip first 4 documents and return from 5 th document

```

4. **Sort Results:**

```js
db.books.find().sort({ rating: -1 });

// Sort by rating in descending order
```

```js
db.books.find().sort({ title: 1 });

// Sort by title in ascending order
```

### Complex Queries and Operators

**Comparison Operators:**

1. `$gt` - Greater than

```js
db.books.find({ rating: { $gt: 8 } });

// return documents with rating is greater than 8
```

2. `$lt` - Less than

```js
db.books.find({ rating: { $lt: 8 } });

// Returns documents where the rating is less than 8
```

3. `$gte`- Greater than or equal to

```js
db.books.find({ rating: { $gte: 8 } });

// Returns documents where the rating is greater than or equal to 8
```

4. `$lte` - Less than or equal to

```js
db.books.find({ rating: { $lte: 8 } });

// Returns documents where the rating is less than or equal to 8
```

**Logical Operators:**

1. **`$or`**
   Matches documents that satisfy at least one of the conditions.

```js
db.books.find({
  $or: [{ rating: 9 }, { author: "Author 2" }],
});

// Returns documents where either the rating is 9 or the author is "Author 2"
```

2. **`$and`**  
   Matches documents that satisfy all the given conditions

```js
db.books.find({
  $and: [{ rating: { $gte: 8 } }, { genre: "genre1" }],
});

// Returns documents where the rating is greater than or equal to 8 and the genre includes "genre1"
```

3. **`$in`**
   Matches documents where the value of a field equals any value in the specified array

```js
db.books.find({
  genre: { $in: ["genre1", "genre2"] },
});

// Returns documents where the genre field includes either "genre1" or "genre2"
```

4. **`$nin`**
   The $nin operator matches documents where the value of a field does not equal any value in the specified array.

```js
db.books.find({
  genre: { $nin: ["genre1", "genre2"] },
});

// Returns documents where the genre field does not include "genre1" or "genre2"
```

### Querying Nested Documents

You can query nested documents by specifying the path to the field within the nested structure.

```js
db.books.find({ "reviews.user": "User1" });

// Returns documents where there is a review with the user "User1"
```

### Querying by Array Values

You can query documents where an array field contains a specific value.

```js
db.books.find({ genre: "genre1" });

// Returns documents where the genre array includes "genre1"
```

## Updating Documents

1. **Update a Single Document:**
   This operation updates the first document that matches the filter criteria.

```js
db.books.updateOne({ title: "Book1" }, { $set: { rating: 10 } });

// Updates the rating of the book titled "Book1" to 10
```

2. **Update Multiple Documents:**
   This operation updates all documents that match the filter criteria.

```js
db.books.updateMany({ author: "Author 1" }, { $set: { rating: 8 } });

// Updates the rating of all books authored by "Author 1" to 8
```

3. **Replace a Document:**
   This operation replaces an entire document with a new one.

```js
db.books.replaceOne(
  { title: "Book1" },
  { title: "New Title", author: "New Author", rating: 7 }
);

// Replaces the entire document with a new one having the specified title, author, and rating
```

### Array Update Operations

1. **Add an Element to an Array:**
   This operation adds a new element to an array within a document.

```js
db.books.updateOne(
  { title: "Book1" },
  {
    $push: { reviews: { user: "User3", comment: "Another review", rating: 4 } },
  }
);

// Adds a new review to the reviews array for the book titled "Book1"
```

2. **Remove an Element from an Array:**
   This operation removes an element from an array within a document.

```js
db.books.updateOne(
  { title: "Book1" },
  { $pull: { reviews: { user: "User1" } } }
);

// Removes the review by "User1" from the reviews array for the book titled "Book1"
```

### Deleting Documents

1. **Delete a Single Document:**
   This operation deletes the first document that matches the filter criteria.

```js
db.books.deleteOne({ title: "Book1" });

// Deletes the document where the title is "Book1"
```

2. **Delete Multiple Documents:**
   This operation deletes all documents that match the filter criteria.

```js
db.books.deleteMany({ author: "Author 1" });

// Deletes all documents where the author is "Author 1"
```

### Indexing

Indexes improve the performance of read operations by allowing the database to quickly locate data.

1. **Create an Index:**
   This command creates an index on the specified field.

```js
db.books.createIndex({ title: 1 });

// Creates an index on the title field in ascending order
```

Output:

```json
"Index creation successful: title_1"
```

2. **View Indexes:**
   This command lists all the indexes on the collection.

```js
db.books.getIndexes();

// Displays all the indexes created on the books collection
```

3. **Drop an Index:**
   This command removes the specified index from the collection.

```js
db.books.dropIndex({ title: 1 });

// Drops the index on the title field
```

Output :

```json
"Index drop successful: title_1"
```
